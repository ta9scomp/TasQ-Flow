# TasQ Flow 統合仕様書

**バージョン**: 1.0.0  
**最終更新**: 2025年6月26日  
**ステータス**: アクティブ

---

## 目次

1. [概要とビジョン](#1-概要とビジョン)
2. [システム要件](#2-システム要件)
3. [機能仕様](#3-機能仕様)
4. [UI/UX設計仕様](#4-uiux設計仕様)
5. [技術仕様](#5-技術仕様)
6. [セキュリティ仕様](#6-セキュリティ仕様)
7. [パフォーマンス仕様](#7-パフォーマンス仕様)
8. [エラーハンドリング仕様](#8-エラーハンドリング仕様)

---

## 1. 概要とビジョン

### 1.1 アプリケーション概要

TasQ Flowは、チームと個人のタスク管理を効率化する高機能ガントチャートベースの業務支援Webアプリケーションです。プロジェクトやタスク、付箋、メンバー管理を一元化し、視覚的に進捗やスケジュールを把握しやすく設計されています。

### 1.2 主要目的

- **視認性の向上**: 多階層の親子構造を持つタスクとプロジェクトを、ガントチャートやリストでわかりやすく表示
- **効率的なタスク管理**: タスクバーのドラッグ＆ドロップ、チェックリスト、タスクフォグなど多様な操作で柔軟な管理を実現
- **チーム協働の促進**: メンバーごとのカラー管理やヒートマップ、権限管理によって透明性と役割分担を明確化
- **高いカスタマイズ性**: ユーザーや権限保持者によるカラー設定、検索条件のボックス化、ナイトモードなど多彩な設定が可能
- **リアルタイム同期**: 同時編集時の競合検知や変更履歴タブにより、チーム全体の情報共有を円滑に
- **拡張性と将来性**: 開発者用のバックパッケージや軽量化設定など、今後の機能拡張を見据えた設計

---

## 2. システム要件

### 2.1 技術スタック

#### フロントエンド（推奨）
- **フレームワーク**: React 18以降 + TypeScript 5以降
- **UIライブラリ**: Material-UI (MUI) v5以降
- **状態管理**: Redux Toolkit または Zustand
- **リアルタイム通信**: WebSocket (Socket.io)
- **ビルドツール**: Vite
- **テスト**: Jest + React Testing Library
- **スタイリング**: Emotion または styled-components

#### バックエンド（推奨）
- **フレームワーク**: Node.js + Express または NestJS
- **データベース**: PostgreSQL（メインDB）+ Redis（キャッシュ）
- **認証**: JWT + OAuth2.0
- **API仕様**: RESTful API + GraphQL（オプション）

### 2.2 パフォーマンス要件
- 初期ロード時間: 3秒以内
- ガントチャート描画: 1000タスクまで60fps維持
- リアルタイム同期遅延: 500ms以内
- モバイル対応: iOS Safari、Android Chrome完全対応

---

## 3. 機能仕様

### 3.1 タスク構造・親子階層

- タスクは1階層の親子構造（グループ化）を持つ
- 「タスクグループ（親）」内に「単体タスク（子）」を複数含められる
- タスクグループ内にさらにグループを作ることは不可
- タスクの並び替えやドラッグでのグループ化/ネスト変更が可能
- ネストによるカラー変更は行わず、子タスクは親タスクのカラーを継承
- タスクグループとプロジェクト列は子タスクの期間を合成したバー（カラーはプリセット薄緑）を表示
- タスクバーは細長い期間表示バー
- チェックリストは単体タスクに設置可能な簡易ToDoリストとして扱う（期間や担当者割当なし）
- タスクには優先度（0～100の数値）を設定可能。デフォルトは50
- タスクにはステータス（未着手・進行中・完了・保留）を設定可能

### 3.2 チェックリスト仕様

- チェックリストは「打ち消し線禁止」
- チェックすると文字色がやや暗くなる
- 項目はドラッグ＆ドロップで並び替え可能
- 項目の追加・削除・編集は変更履歴に残す
- チェックのON/OFFや順番変更は履歴に記録しない

### 3.3 タスクバー・タスクフォグ仕様

- タスクバーは通常の期間表示（細長いバー）
- タスクフォグは本人のみが作成可能。重複不可
- タスクフォグは画面の上下にかけて網掛け・斜線表示
- タスクフォグのカラーは作成者のメンバーカラーを自動適用
- ユーザーは「アサイン時・フォグ作成時のカラー」を変更可能。変更後は既存の関連バー・フォグにも反映
- 視認性確保のため、自動カラー補正機能（明るさ調整等）を設け、ON/OFF切替可能
- タスクバー・タスクフォグには縁取り（ボーダー）を設定可能
  - 縁取りの太さ：1px・2px・3pxから選択
  - 縁取りの色：自動設定または手動設定
  - 縁取りのスタイル：実線・点線・破線から選択

### 3.4 プライベートタスク公開設定

- 完全公開：詳細情報がチーム全員に見える
- 期間のみ公開：匿名化され期間・カラーのみ表示。担当者・タグは非表示
- 完全非公開：ヒートマップ型のインジケーターのみ表示（誰かが予定ありとわかるが詳細不可視）

### 3.5 検索機能

- 複数条件検索をサポート
- 入力補助で@（担当者）、#（タグ）、%（進捗度）、^（キャパシティ）、!（優先度）、$（ステータス）など記号による絞り込みを実装
  - 優先度は数値範囲指定可能（例：!>70、!50-80、!<=30）
- 入力時はサジェスト表示。条件ボックス化可能（クリックで作成、右クリックで解除）
- 検索中は他コンテンツを薄暗くし、該当タスクをハイライト表示
- 検索履歴はユーザー単位で最大5件保存可能。履歴の削除・保存件数はユーザー設定で変更可能
- 検索結果のナビゲーション（上下キー・次・前ボタン）を提供
- 保存した検索条件をフィルタとして再利用可能（お気に入り検索）

### 3.6 タブ構成

- **ガントチャートタブ**: プロジェクト単位のタスク期間表示（タスクバー・フォグ）、合成バー（親グループ・プロジェクトの合計期間バー）表示
- **メンバータブ**: メンバー別スケジュール・タスク一覧表示、非表示メンバーはまとめて折り畳み表示可能、ヒートマップ型空き状況表示（%基準、非表示/表示切替可、権限者が設定可能）
- **付箋タブ**: アクリル風透明感付箋の一覧・管理、**付箋一覧機能「StickyList」**: 右下の目のアイコンで切替表示可能な透明パネル
- **ToDoタブ**: タスクごとのToDoチェックリストの一覧管理
- **変更履歴タブ（権限者のみ）**: タスク・付箋の期間変更、作成・削除履歴を新着順で閲覧可能、メンバー・対象別のフィルタ機能あり

### 3.7 付箋一覧機能「StickyList」詳細仕様

#### 機能概要
- **機能名**: StickyList（付箋一覧表示機能）
- **アクセス方法**: 付箋タブ内の右下フローティングアクションボタン（目のアイコン）
- **表示形式**: 右側サイドパネル（透明度・ガラスモーフィック）

#### UI・デザイン仕様
- **パネル位置**: 画面右端、全高
- **幅**: 300px固定
- **背景**: ガラスモーフィック（白半透明 + ブラー効果）
  - `backgroundColor: rgba(255, 255, 255, 0.15)`
  - `backdropFilter: blur(25px) saturate(180%)`
  - 上端グラデーション装飾とボーダー効果
- **影効果**: 8px複合シャドウ + インナーハイライト
- **表示切替**: ワンクリックで開閉、滑らかなスライドアニメーション

---

## 4. UI/UX設計仕様

### 4.1 デザインシステム

- **テーマ**: Material Design準拠
- **カラーパレット**: プライマリ（#2196F3）、セカンダリ（#FF9800）
- **タイポグラフィ**: Roboto, Noto Sans JP
- **スペーシング**: 8pxベースのグリッドシステム
- **角丸**: 8px統一

### 4.2 レスポンシブデザイン

- **ブレイクポイント**: xs(<600px), sm(600px), md(960px), lg(1280px), xl(1920px)
- **モバイル優先設計**: Mobile First アプローチ
- **タッチ操作最適化**: 44px以上のタップターゲット

---

## 5. 技術仕様

### 5.1 コンポーネント設計

```typescript
// コンポーネント命名規則
interface ComponentProps {
  // プロパティ定義
}

export const ComponentName: React.FC<ComponentProps> = ({ props }) => {
  // 実装
};
```

### 5.2 状態管理

```typescript
// Zustand ストア例
interface AppStore {
  selectedView: string;
  selectedTeamId?: string;
  selectedProjectId?: string;
  // アクション
  setSelectedView: (view: string) => void;
}
```

---

## 6. セキュリティ仕様

- HTTPS必須
- XSS・CSRF対策実装
- SQLインジェクション対策
- 適切なCORS設定
- データ暗号化（保存時・通信時）
- 定期的なセキュリティ監査
- 2要素認証（2FA）オプション

---

## 7. パフォーマンス仕様

### 7.1 最適化戦略

- **遅延ローディング**: コンポーネントの動的インポート
- **メモ化**: React.memo、useMemo、useCallbackの適切な使用
- **仮想化**: 大量データ表示時の仮想スクロール
- **キャッシュ戦略**: ブラウザキャッシュとサーバーキャッシュの最適化

### 7.2 軽量化モード

- PC版はリッチで光沢表現・光反射アニメなど高品質UIを目指すが、負荷軽減のため軽量化モードをユーザーが選択可能
- モバイル版は自動的に軽量デザインに切り替え
- サジェスト履歴やヒートマップ等もパフォーマンスを考慮し調整可能

---

## 8. エラーハンドリング仕様

### 8.1 エラーバウンダリ

```typescript
interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
  errorInfo?: ErrorInfo;
}

class ErrorBoundary extends Component<Props, ErrorBoundaryState> {
  // エラーキャッチとグレースフルな障害処理
}
```

### 8.2 エラー通知システム

- **Toast形式**: 非侵入的エラー通知
- **エラー分類**: ネットワーク・バリデーション・権限・データ・パフォーマンス
- **自動復旧**: 再試行ボタン提供
- **統計機能**: 過去24時間のエラー集計表示

### 8.3 エラーログ管理

- **自動記録**: エラー発生時刻・種別・頻度
- **環境情報**: ブラウザ・URL・操作履歴の収集
- **開発者情報**: スタックトレース情報とコンポーネント階層
- **プライバシー保護**: ログクリア機能とデータプライバシー保護

---

## 改訂履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|----------|--------|
| 1.0.0 | 2025-06-26 | 初版作成、既存仕様書の統合 | Claude |

---

**注意**: この仕様書は生きた文書であり、開発の進捗に応じて継続的に更新されます。