# TasQ Flow 統合要件定義書

## 概要

TasQ Flowは、チームと個人のタスク管理を効率化する高機能ガントチャート・カレンダー統合型業務支援Webアプリです。  
プロジェクトやタスク、付箋、メンバー管理を一元化し、ガントチャートとカレンダー表示の両方で視覚的に進捗やスケジュールを把握しやすく設計されています。  
モバイル対応と高性能なPC表示の両立、使いやすい検索・フィルタ機能、詳細なカラー管理、リアルタイムの変更履歴追跡も備えています。

---

## 目的

- **視認性の向上**：多階層の親子構造を持つタスクとプロジェクトを、ガントチャート・カレンダー・リストでわかりやすく表示
- **効率的なタスク管理**：タスクバーのドラッグ＆ドロップ、チェックリスト、タスクフォグなど多様な操作で柔軟な管理を実現
- **カレンダー統合**：月表示スナップ機能により直感的な日程確認とスケジュール同期を提供
- **チーム協働の促進**：メンバーごとのカラー管理やヒートマップ、権限管理によって透明性と役割分担を明確化
- **高いカスタマイズ性**：ユーザーや権限保持者によるカラー設定、検索条件のボックス化、多言語対応など多彩な設定が可能
- **リアルタイム同期**：同時編集時の競合検知や変更履歴タブにより、チーム全体の情報共有を円滑に

---

## 01. タスク構造・親子階層

### 1.1 基本階層構造
- タスクは1階層の親子構造（グループ化）を持つ
- 「タスクグループ（親）」内に「単体タスク（子）」を複数含められる
- タスクグループ内にさらにグループを作ることは不可
- タスクの並び替えやドラッグでのグループ化/ネスト変更が可能

### 1.2 表示仕様
- ネストによるカラー変更は行わず、子タスクは親タスクのカラーを継承
- タスクグループとプロジェクト列は子タスクの期間を合成したバー（カラーはプリセット薄緑）を表示
- タスクバーは細長い期間表示バー
- チェックリストは単体タスクに設置可能な簡易ToDoリストとして扱う（期間や担当者割当なし）

### 1.3 属性管理
- タスクには優先度（0～100の数値）を設定可能。デフォルトは50
- タスクにはステータス（未着手・進行中・完了・保留）を設定可能
- タスク名、開始・終了日、担当メンバー、タグ、付箋の管理

---

## 02. カレンダー・月表示統合機能

### 2.1 月表示位置とスナップ挙動
- 月表示（"YYYY年MM月"などの形式）は、画面の左右バランスが取れた中央付近に配置
- スクロール操作時、月表示は対応する「月の初日」または「月の最終日」とスナップし、該当する日付セルとともに滑らかに移動

### 2.2 スクロール方向と挙動詳細
#### 右から左方向のスクロール（未来日程確認時）
- 月の初日セルとともに月表示が画面内へ現れる
- 月表示は初日セル上にスナップし、左方向へ滑らかに移動
- 画面中央に月の最終日が到達すると、その月の月表示はスナップ解除され左方向へ画面外へ退場

#### 左から右方向のスクロール（過去日程確認時）
- 月の最終日セルとともに月表示が画面内へ現れる
- 月表示は最終日セル上にスナップし、右方向へ滑らかに移動
- 画面中央に月の初日が到達すると、その月の月表示はスナップ解除され右方向へ画面外へ退場

### 2.3 多言語対応
- 日本語："YYYY年MM月"
- 英語："YYYY/MM"
- ユーザー設定画面およびカレンダー部右クリックメニューから言語変更可能

### 2.4 スケール仕様
- 日付セルは均等幅で配置
- スケール変更によりセル幅の縮小・拡大が可能
- 最大縮小率・最大拡大率の上限下限を仕様で明確に定義
- セル幅が狭くても最低限の装飾（色付け）は必ず可能
- 拡大時は文字表示がフェードイン・アウトで滑らかに切り替わる仕様

---

## 03. 祝日・イベント管理統合仕様

### 3.1 基本分類
- **祝日**: 「祝日グループ」として一括管理されるイベント群
- **イベント**: 祝日以外のユーザーが任意に設定する予定イベント・記念日等
- 祝日もイベントの一種として扱うが、見た目や管理上区別する

### 3.2 カラーリング・表示
- 祝日・週末のカラーリングはアプリのデフォルトプリセットで自動適用
- ユーザーは祝日ごとにカラーを個別指定可能
- 祝日グループ全体に対して一括でカラー変更も可能
- イベントはグループ化が可能で、グループ単位で一括カラー変更ができる
- 日付セルの下部（または目立たせやすい位置）に該当祝日・イベントの色を表示
- セル幅が十分に広ければ文字表示も可能（フェードイン・アウト効果を利用）

### 3.3 編集・管理機能
- チェックボックス方式で祝日の追加・削除を簡単に行えるUI
- 名称編集可能
- 連続する複数日の祝日をまとめて「ゴールデンウィーク」等のグループ名称で管理可能
- 日本の祝日・海外祝日などのプリセットを用意し、ユーザーは切り替え・カスタム可能
- イベントはドラッグ＆ドロップで並び替え可能
- イベントグループ（複数のイベントをまとめる単位）を自由に作成・解体可能

### 3.4 アーカイブ・ループ機能
- アーカイブ済みイベントは祝日の下にまとめて表示
- 単発イベントが終了し日付が過ぎた場合は自動でアーカイブへ移動
- ループイベント（誕生日など）は次回開催日を表示し、常に一覧に残る

### 3.5 共有・提案機能
- プロジェクトチーム内で独自祝日やイベントを提案可能
- 送信者は自身の祝日・イベントリストから、もしくは新規作成して提案
- 受信者は通知アイコンから提案を確認し、受け入れたいものにチェックを入れて承認
- 重複イベントの比較・選択機能

### 3.6 付箋・タグ機能
- イベント・祝日に付箋を1色ずつ割り当て可能。複数付箋は複数アイコン表示
- 付箋にホバーすると簡易ポップアップで内容を表示
- イベントにタグ表示は付箋より優先される
- 簡易チェックボックス機能をイベントに付加可能（ToDoとは別）

---

## 04. チェックリスト仕様

- チェックリストは「打ち消し線禁止」
- チェックすると文字色がやや暗くなる
- 項目はドラッグ＆ドロップで並び替え可能
- 項目の追加・削除・編集は変更履歴に残す
- チェックのON/OFFや順番変更は履歴に記録しない

---

## 05. タスクバー・タスクフォグ仕様

### 5.1 基本表示
- タスクバーは通常の期間表示（細長いバー）
- タスクフォグは本人のみが作成可能。重複不可
- タスクフォグは画面の上下にかけて網掛け・斜線表示
- タスクフォグのカラーは作成者のメンバーカラーを自動適用

### 5.2 カラー管理
- ユーザーは「アサイン時・フォグ作成時のカラー」を変更可能
- 変更後は既存の関連バー・フォグにも反映
- 視認性確保のため、自動カラー補正機能（明るさ調整等）を設け、ON/OFF切替可能

### 5.3 縁取り機能（統合）
- 縁取りの太さ：1px・2px・3pxから選択
- 縁取りの色：自動設定または手動設定
- 縁取りのスタイル：実線・点線・破線から選択
- 縁取り色の自動設定時は、バー/フォグの色に対してコントラストのある色を自動選択
- ユーザー設定で縁取りのON/OFF切替可能
- プロジェクト単位で縁取りのデフォルト設定を管理可能

---

## 06. プライベートタスク公開設定

- **完全公開**: 詳細情報がチーム全員に見える
- **期間のみ公開**: 匿名化され期間・カラーのみ表示。担当者・タグは非表示
- **完全非公開**: ヒートマップ型のインジケーターのみ表示（誰かが予定ありとわかるが詳細不可視）

---

## 07. 検索機能統合仕様

### 7.1 複数条件検索
- 入力補助で@（担当者）、#（タグ）、%（進捗度）、^（キャパシティ）、!（優先度）、$（ステータス）など記号による絞り込み
- 優先度は数値範囲指定可能（例：!>70、!50-80、!<=30）
- 入力時はサジェスト表示。条件ボックス化可能（クリックで作成、右クリックで解除）

### 7.2 UI・UX
- 検索ボックスはクリックで幅が滑らかに拡大
- 検索中は他コンテンツを薄暗くし、該当タスクをハイライト表示
- 検索結果のナビゲーション（上下キー・次・前ボタン）を提供

### 7.3 履歴・お気に入り機能
- 検索履歴はユーザー単位で最大5件保存可能（設定で0～10件変更可能）
- 保存した検索条件をフィルタとして再利用可能（お気に入り検索）

---

## 08. タブ構成統合

### 8.1 ガントチャートタブ
- プロジェクト単位のタスク期間表示（タスクバー・フォグ）
- 合成バー（親グループ・プロジェクトの合計期間バー）表示
- カレンダー月表示との完全同期

### 8.2 メンバータブ
- メンバー別スケジュール・タスク一覧表示
- プライベート＋チームプロジェクトの合成スケジュール2行表示
- 非表示メンバーはまとめて折り畳み表示可能
- ヒートマップ型空き状況表示（%基準、非表示/表示切替可、権限者が設定可能）

### 8.3 付箋タブ
- アクリル風透明感付箋の一覧・管理
- 付箋はタスクに紐づけ可能だが、付箋自体はタスクやグループとは独立
- 付箋は繰り返し使える。タスクのアーカイブに影響されない

### 8.4 ToDoタブ（統合）
- タスクごとのToDoチェックリストの一覧管理
- タスクは長方形の領域内に詳細情報を表示可能
- タスク内に簡易チェックボックスを複数配置し、タスクの状態を細かく管理
- ガントチャートタブとToDoタブで表示されるタスクは完全に同期
- タスク名、開始・終了日、担当メンバー、タグ、付箋の表示・編集を両タブで可能

### 8.5 変更履歴タブ（権限者のみ）
- タスク・付箋の期間変更、作成・削除履歴を新着順で閲覧可能
- メンバー・対象別のフィルタ機能あり
- 変更種別でフィルタ可能（タスク作成、削除、編集、付箋操作、チェックリスト操作など）
- 変更の取り消し操作を権限者が実行可能

### 8.6 プロジェクトチーム設定タブ
- メンバー権限設定、権限譲渡、チーム設定
- カラープリセット管理

---

## 09. メンバーカラー・カラー管理統合

### 9.1 基本設定
- プロジェクト権限保持者がカラープリセット（パステル・ビビッド・色覚対応など）を選択
- ユーザーは初期登録時にメンバーカラーを提案され、一度決めたら基本変更不可
- タスク・フォグのカラーはアサインカラー優先。未アサインは自動割当カラー

### 9.2 自動カラー補正
- 明度（L値）と彩度（S値）をHSL色空間で判定
- 明度が80%以上（非常に明るい）または20%以下（非常に暗い）は補正対象
- 補正方法は明るすぎる場合はグレー寄りに下げ、暗すぎる場合は明るく調整
- 補正はユーザーがON/OFF設定可能

### 9.3 優先ルール
- プロジェクトチームの権限保持者がカラープリセットを設定した場合は、そのプリセットが優先
- タスクにメンバーがアサインされていれば、そのメンバーのカラーが優先
- 複数メンバーがアサインされている場合は代表者のカラーを優先

---

## 10. ヒートマップ表示統合仕様

### 10.1 基本表示ルール
- 表示単位は日単位（時間単位の細分化は現時点で非採用）
- スケジュールキャパシティの％に応じて色の強弱で表示
- 例：4人メンバーの場合、誰もスケジュール無し＝100%、1人100%タスクあり＝75%
- 小数点以下3桁までの精度で計算

### 10.2 カラー・強度ルール
- 0%：完全透明（無色）
- 1～25%：非常に薄い色（最も淡いトーン）
- 26～50%：薄い色
- 51～75%：中間の濃さ
- 76～99%：濃い色
- 100%：最も濃く、強調表示

### 10.3 設定・制御
- ヒートマップ表示は基本非表示。メンバーごとにショートカットで表示切替可能
- ベースカラーは権限保持者がプロジェクトチームごとに設定可能
- 表示設定はログインユーザーごとに保存され、再ログイン後も復元

---

## 11. デザイン・パフォーマンス

### 11.1 基本方針
- PC版はリッチで光沢表現・光反射アニメなど高品質UIを目指すが、負荷軽減のため軽量化モードをユーザーが選択可能
- モバイル版は自動的に軽量デザインに切り替え
- サジェスト履歴やヒートマップ等もパフォーマンスを考慮し調整可能

### 11.2 アニメーション・エフェクト
- 検索ボックス拡大アニメーション、サジェスト・条件ボックス化は滑らかに動作
- メニューアイコン・ハンバーガーボタンはホバーで明るく、クリック時は一時的にさらに明るくなるエフェクト
- タスクバークリックでリップルエフェクト
- 光沢表現はPC版のみ、負荷監視の上で表示

---

## 12. ログイン・画面表示

### 12.1 ホーム画面
- 自分のプライベートスケジュールを最上部に表示し、プロジェクト横断的に予定一覧を閲覧可能
- 続けて、アサインされた各プロジェクトのタスク一覧を表示

### 12.2 リログ時挙動
- 最後に閲覧したプロジェクトチームの当日付の位置を表示
- 前回開いていたプロジェクトチームの今日の日付へ自動スクロール

---

## 13. 変更履歴管理統合

### 13.1 記録対象
- タスクの期間変更や新規作成、削除、付箋の変更は権限者のみ閲覧可能な履歴タブに記録
- チェックリストのチェックON/OFFや並び替えは履歴に残さない
- チェックリストの作成・削除・文字変更は変更履歴に記録

### 13.2 管理機能
- フィルタ機能で対象メンバーやタスク・付箋別に絞り込み可能
- 新着順表示が基本
- 変更詳細はログに記録し、UI上で差分が分かる形で展開表示
- 権限保持者は変更履歴を使い、差分をマージまたは再適用可能

---

## 14. 開発者用管理ページ

### 14.1 アクセス権限
- 権限保持者とは別に「開発者」権限を持つユーザーがアクセス可能
- アカウント設定内に「開発者用メニュー」を設置（一般ユーザー非表示）

### 14.2 管理機能
- カラープリセット管理（追加・削除・編集）
- システムログ閲覧（操作ログ、エラーなど）
- パフォーマンスモニター（CPU負荷、メモリ使用量等）
- 仮想ユーザー生成（テスト用データ作成）
- 機能フラグ管理（軽量化モード切替、実験的機能ON/OFFなど）
- キャッシュクリア・データベースリセット操作

### 14.3 セキュリティ
- すべての操作はログ記録。権限保持者も操作履歴閲覧可能

---

## 15. 同時編集・競合解消の仕様

### 15.1 基本動作
- タスク・付箋・チェックリストの変更はリアルタイムに反映
- 同時に複数ユーザーが同じ項目編集時は最後に送信された内容を優先
- 他ユーザーによる変更がリアルタイムで表示され、衝突の可能性を警告

### 15.2 競合処理
- 競合が起きた場合は画面上に警告を表示し、差分確認タブを権限保持者に提供
- 衝突検出時はユーザーに通知し、編集中の内容を保存するか破棄するか選択可能
- 権限により編集ロックも可能（例：権限者がロック設定）

---

## 16. プロジェクトチーム設定・権限管理

### 16.1 基本権限
- チーム作成者（権限保持者）が管理
- メンバー追加・削除、権限付与（編集可・閲覧のみ等）可能
- チーム作成者権限は譲渡可

### 16.2 表示・カラー設定
- メンバー毎に表示設定やカラー指定可能だが、カラーは初回決定後原則変更不可
- 権限による機能制限（変更履歴閲覧権限など）を明確化

---

## 17. 優先度管理の詳細仕様

### 17.1 基本仕様
- 優先度は0～100の整数値で管理
- デフォルト値は50（中間値）
- 値が大きいほど優先度が高い

### 17.2 入力UI
- スライダーUI（ドラッグで直感的に設定）
- 数値直接入力フィールド
- クイック設定ボタン（0・25・50・75・100）
- キーボードショートカット（+/-キーで5ずつ変更）

### 17.3 表示・色分けルール
- 80～100：緊急（赤系カラー、アイコン：🔴）
- 50～79：高（黄・オレンジ系カラー、アイコン：🟡）
- 20～49：中（緑系カラー、アイコン：🟢）
- 0～19：低（グレー系カラー、アイコン：⚪）

### 17.4 ソート・フィルタ機能
- 優先度昇順・降順ソート
- 数値範囲指定フィルタ（!>70、!50-80、!<=30など）
- カテゴリ別フィルタ（緊急・高・中・低）

### 17.5 ガントチャートでの表現
- タスクバーの色の濃淡で優先度を表現
- タスクバー左端に優先度インジケーター表示
- ホバー時に優先度数値をツールチップ表示

---

## 18. 技術仕様・推奨事項

### 18.1 フロントエンド技術スタック（推奨）
- **フレームワーク**: React 18以降 + TypeScript 5以降
- **UIライブラリ**: Material-UI (MUI) v5以降
- **状態管理**: Redux Toolkit または Zustand
- **リアルタイム通信**: WebSocket (Socket.io)
- **ビルドツール**: Vite
- **テスト**: Jest + React Testing Library
- **スタイリング**: Emotion または styled-components

### 18.2 バックエンド技術スタック（推奨）
- **フレームワーク**: Node.js + Express または NestJS
- **データベース**: PostgreSQL（メインDB）+ Redis（キャッシュ）
- **認証**: JWT + OAuth2.0
- **API仕様**: RESTful API + GraphQL（オプション）

### 18.3 パフォーマンス要件
- 初期ロード時間: 3秒以内
- ガントチャート描画: 1000タスクまで60fps維持
- リアルタイム同期遅延: 500ms以内
- モバイル対応: iOS Safari、Android Chrome完全対応

---

## 19. セキュリティ要件

- HTTPS必須
- XSS・CSRF対策実装
- SQLインジェクション対策
- 適切なCORS設定
- データ暗号化（保存時・通信時）
- 定期的なセキュリティ監査
- 2要素認証（2FA）オプション

---

## 20. アクセシビリティ要件

- WCAG 2.1 レベルAA準拠
- キーボードナビゲーション完全対応
- スクリーンリーダー対応
- 高コントラストモード
- フォントサイズ調整機能
- 多言語対応（日本語・英語は必須）

---

## 21. データエクスポート・インポート機能

- CSV/Excel形式でのタスクデータエクスポート
- ガントチャートのPDF/画像出力
- プロジェクトテンプレートの保存・共有
- 他のプロジェクト管理ツールからのデータインポート（Trello、Asana、Jira形式対応）
- APIによる外部システム連携

---

## 22. 通知・アラート機能

- タスク期限接近通知
- 担当タスクの変更通知
- メンション通知（@ユーザー名）
- デスクトップ通知対応
- メール通知設定（個別カスタマイズ可能）
- Slack/Teams連携（オプション）

---

【TasQ Flow 統合要件定義書 完了】

---